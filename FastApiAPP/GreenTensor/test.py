import math
from LensCalculator import LensCalculator
from Lens import Lens
from LensPlotCreator import LensPlotCreator
import numpy as np

if __name__ == "__main__":
    # Создание экземпляров
    k0 = 4 * math.pi
    toch = 90
    n = 4
    phi1 = 0 * math.pi / 2  # 0 градусов
    phi2 = 1 * math.pi / 2  # 90 градусов
    a = None
    eps = None
    miy = None
    k1 = k0
    
    lens1 = Lens(k0, toch, n, phi1, a, eps, miy, k1=k1)
    lens2 = Lens(k0, toch, n, phi2, a, eps, miy, k1=k1)

    rcs_calc1 = LensCalculator(lens1)
    rcs_calc2 = LensCalculator(lens2)
    
    # Выполнение расчетов
    rcs_calc1.run_calculation()
    rcs_calc2.run_calculation()

    plotter = LensPlotCreator(calculator=rcs_calc1)
    plotter.plot_single()

    plotter.setup_comparison(reference=rcs_calc2)
    plotter.plot_comparison()
    
    DN_Ansys_k05_0 = [-0.00155540927079118, -0.00501804918430946, -0.0103876264141705, -0.0176642701454366, -0.026848531343755, -0.0379413819993986, -0.0509442144445386, -0.0658588408534557, -0.0826874930460081, -0.10143282272349, -0.122097902273994, -0.144686226290478, -0.16920171394982, -0.195648712404226, -0.224032001338438, -0.254356798846375, -0.286628768779805, -0.320854029719089, -0.357039165712258, -0.39519123892349, -0.435317804325894, -0.477426926566315, -0.521527199121755, -0.567627765858329, -0.615738345094403, -0.665869256260067, -0.718031449235473, -0.772236536441144, -0.828496827744162, -0.886825368235812, -0.947235978928522, -1.00974330041348, -1.07436283951527, -1.14111101897625, -1.210005230202, -1.28106388909967, -1.35430649504419, -1.42975369301312, -1.50742733893966, -1.58735056834539, -1.66954786833016, -1.75404515301561, -1.84086984256292, -1.93005094591294, -2.02161914743007, -2.11560689766899, -2.21204850852671, -2.31098025309182, -2.41244047055823, -2.51646967663303, -2.62311067993805, -2.73240870498187, -2.84441152236581, -2.95916958698294, -3.07673618507543, -3.19716759113349, -3.32052323574964, -3.44686588568731, -3.57626183758387, -3.70878112688785, -3.84449775383066, -3.98348992845746, -4.12584033699347, -4.27163643210574, -4.42097074994029, -4.57394125717767, -4.73065173176283, -4.89121218143678, -5.0557393047379, -5.22435699976314, -5.39719692669767, -5.57439913095537, -5.75611273474292, -5.94249670599526, -6.13372071496129, -6.32996609028842, -6.53142688831063, -6.73831109144979, -6.95084195427091, -7.16925951888207, -7.39382232516137, -7.62480934587368, -7.86252218230267, -8.10728756280889, -8.3594601950458, -8.61942603282226, -8.88760603131428, -9.16446048018145, -9.45049402403237, -9.74626150480038, -10.0523747925312, -10.3695108120043, -10.6984210254463, -11.0399427004022, -11.3950123822315, -11.7646821106411, -12.1501390804512, -12.5527296647525, -12.9739890176808, -13.415677889786, -13.8798288752304, -14.3688051496845, -14.8853759809535, -15.4328151099548, -16.0150308510421, -16.6367410273337, -17.303712645981, -18.0230973399871, -18.8039124325549, -19.6577505856329, -20.5998618009691, -21.6508690942085, -22.8396206625529, -24.2082153093246, -25.8215301530403, -27.7870845415461, -30.3020779368384, -33.7859647325147, -39.3286705968909, -46.1824083457531, -38.6665791781876, -33.4899906378492, -30.2014299268172, -27.8201136288044, -25.9613415999964, -24.4409702687279, -23.1573827756319, -22.0487505766626, -21.0747120657191, -20.2074870757416, -19.4271506188623, -18.7189327501797, -18.071585690888, -17.4763495325943, -16.9262713914129, -16.4157424340824, -15.9401741897799, -15.4957667395332, -15.0793391817641, -14.6882033279822, -14.3200680466575, -13.9729657469106, -13.6451951270768, -13.3352760548362, -13.0419136213026, -12.7639692199881, -12.5004370670386, -12.2504249807593, -12.013138527759, -11.7878678541698, -11.5739766763296, -11.3708930217702, -11.1781013992268, -10.9951361433304, -10.8215757311154, -10.6570379073678, -10.5011754870197, -10.3536727273404, -10.2142421821307, -10.0826219656584, -9.95857336654984, -9.8418787619267, -9.73233979027788, -9.62977574824773, -9.53402218203023, -9.44492964860547, -9.36236262583399, -9.28619855357999, -9.21632699068404, -9.15264887484305, -9.09507587435512, -9.04352982230991, -8.99794222520132, -8.95825383914885, -8.92441430796973, -8.89638185827471, -8.87412304758818, -8.85761256223874, -8.84683306244535, -8.84177507265241, -8.84243691575668, -8.84882469043192, -8.8609522913049, -8.87884147227862, -8.90252195384606, -8.93203157580103, -8.96741649734236, -9.00873144719565, -9.05604002705675, -9.10941507240663, -9.16893907557624, -9.23470467687241, -9.30681523063329, -9.38538545429498, -9.47054216995101, -9.56242514951524, -9.66118807650657, -9.76699963972084, -9.88004477671829, -10.0005260882281, -10.1286654483719, -10.2647058401858, -10.4089134514614, -10.56158007267, -10.7230258469892, -10.8936024326078, -11.0736966500565, -11.2637347029731, -11.4641870803328, -11.6755742729347, -11.8984734683945, -12.1335264291654, -12.3814488100698, -12.6430412394361, -12.9192025767081, -13.210945877075, -13.5194177513036, -13.8459220224552, -14.1919488738493, -14.5592110891027, -14.9496895576153, -15.3656910378923, -15.8099223626439, -16.2855870356891, -16.796512842638, -17.3473232331684, -17.9436717999539, -18.5925699113069, -19.3028556734228, -20.0858841500412, -20.9565768598482, -21.9350803464205, -23.049511902844, -24.3407715092745, -25.8715996217535, -27.7452723332887, -30.1492037450229, -33.4747114867723, -38.701702720482, -45.5793657632033, -38.7828079593651, -33.4369961430316, -30.024473802846, -27.545473338234, -25.601904956144, -24.0037483693181, -22.6465218375491, -21.4668426682872, -20.4234287263843, -19.4879136980514, -18.6399758347179, -17.8645620267881, -17.1502127675127, -16.4880031632495, -15.8708469824674, -15.2930240951681, -14.749850504198, -14.2374423049485, -13.75254323226, -13.2923962980894, -12.8546466555652, -12.4372669993731, -12.0384995078967, -11.6568101133681, -11.2908520873103, -10.939436753774, -10.6015097195565, -10.2761314198766, -9.96246107259596, -9.65974334894015, -9.36729722726642, -9.08450661479432, -8.81081241148734, -8.54570575824678, -8.28872226380657, -8.03943704518417, -7.7974604481462, -7.562434339013, -7.33402887882725, -7.11193970662642, -6.8958854711699, -6.68560566065552, -6.48085868822843, -6.28142019783702, -6.08708156053055, -5.89764853586354, -5.7129400768597, -5.53278726014169, -5.35703232547183, -5.18552781116443, -5.01813577370083, -4.85472708146168, -4.69518077383868, -4.53938347813766, -4.38722887767066, -4.23861722528188, -4.09345489728321, -3.9516539834081, -3.81313190894048, -3.6778110856539, -3.54561858861145, -3.41648585624154, -3.29034841142203, -3.16714560158467, -3.04682035609567, -2.92931895938303, -2.81459083846907, -2.70258836373165, -2.59326666186203, -2.48658344011365, -2.38249882104662, -2.28097518706902, -2.18197703415926, -2.08547083422695, -1.99142490563112, -1.89980929142926, -1.81059564497557, -1.723757122526, -1.63926828254005, -1.55710499139667, -1.47724433526364, -1.39966453787836, -1.32434488401211, -1.25126564840142, -1.18040802993868, -1.11175409092025, -1.04528670115479, -0.980989486736762, -0.918846783291721, -0.858843593499726, -0.800965548702814, -0.745198874401045, -0.691530359439901, -0.639947328690156, -0.590437619019136, -0.542989558350823, -0.497591947610575, -0.454234045349434, -0.412905554842382, -0.373596613455193, -0.336297784075607, -0.301000048406264, -0.267694801919841, -0.236373850280475, -0.207029407040532, -0.179654092427666, -0.154240933044164, -0.130783362308751, -0.109275221480151, -0.0897107611121882, -0.0720846428012384, -0.0563919410994387, -0.0426281454799613, -0.0307891622547469, -0.0208713163597323, -0.0128713529378774, -0.00678643866601753, -0.00261416278764306, -0.000352537829948328]

    plotter.setup_comparison(reference=np.array(DN_Ansys_k05_0))
    plotter.plot_comparison()
    # # Создание и запуск анализа
    # sweep = ParameterSweep(
    #     simulation_class=RCSCalculator,
    #     k0_start=k0_start,
    #     k0_stop=k0_stop,
    #     k0_step=k0_step,
    #     phi0=phi0
    # )
    # for phi0 in np.arange((np.pi)/4, (np.pi)/2, (np.pi)/4):
    #     sweep = ParameterSweep(
    #     simulation_class=RCSCalculator,
    #     k0_start=k0_start,
    #     k0_stop=k0_stop,
    #     k0_step=k0_step,
    #     phi0=phi0
    #     )
    #     sweep.run_sweep()
    #     sweep.plot_heatmap(output_file=f'φ0{phi0:f}k0_sweep_heatmap.png')